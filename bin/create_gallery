#!/usr/bin/env ruby

require "youtube_it"

client = YouTubeIt::Client.new(:username => "ignitebaltimore", :password => ENV['IGNITE_YOUTUBE_PW'], :dev_key => ENV['IGNITE_YOUTUBE_KEY'])
playlist = client.playlist("3401412D6B7CD892")

videos = playlist.videos.sort_by(&:favorite_count).reverse.first(24)

File.open("#{File.dirname(__FILE__)}/../_includes/video_gallery.html","w") do |f|
  videos.each_slice(4) do |slice|
    f.puts "<div class='row'>"

    slice.each_with_index do |video,idx|
      thumb = video.thumbnails.find { |t| t.width == 480 }
      url = thumb.url
      width = thumb.width
      height = thumb.height

      f.puts "<div class='col3 video_thumb'>"
      f.puts "<a href='#{url}'><img alt='#{video.title}' src='#{url}' width='162' height='121'></a>"

      f.puts <<-META
      <div class="video_title">
        <a href="#{url}">#{video.title}</a>
      </div>
      META
      
      f.puts "</div>"
    end

    f.puts "<div class='row-end'>&nbsp;</div></div>"
  end
end
